<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¨ë„/ì°©ì„ ìƒíƒœ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 60px;
      background:#f4f4f4;
    }
    .card {
      display:inline-block;
      background:#fff;
      padding:18px 24px;
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
      text-align:left;
    }
    p { margin:8px 0; }
    .alarm-on { color:#d9534f; font-weight:bold; }
    .alarm-off { color:#555; }
    a {
      display:inline-block;
      margin-top:16px;
      text-decoration:none;
      color:#007bff;
    }
  </style>
</head>
<body>
  <h1>ì˜¨ë„ / ì°©ì„ ìƒíƒœ</h1>
  <div class="card">
    <p id="temp">ì˜¨ë„: - Â°C</p>
    <p id="ac">ì—ì–´ì»¨: -</p>
    <p id="seatUsed">ì°©ì„: -</p>
    <p id="alarm">ì•ŒëŒ: -</p>
    <p id="alarmMessage"></p>
  </div>
  <p>
    <a href="/">â† ë©”ë‰´ë¡œ</a> |
    <a href="/reservation">ì¢Œì„ ì˜ˆì•½ í˜ì´ì§€ë¡œ â†’</a>
  </p>

  <script>
    async function fetchStatus() {
      try {
        const res = await fetch('/api/status');
        const data = await res.json();
        const { state } = data;

        const tempEl = document.getElementById('temp');
        const acEl = document.getElementById('ac');
        const seatEl = document.getElementById('seatUsed');
        const alarmEl = document.getElementById('alarm');
        const alarmMsgEl = document.getElementById('alarmMessage');

        // seatReservedê°€ êº¼ì ¸ ìˆìœ¼ë©´ ê°’ ì•ˆ ë³´ì—¬ì£¼ê¸°
        if (!state.seatReserved) {
          tempEl.textContent  = 'ì˜¨ë„: - Â°C';
          acEl.textContent    = 'ì—ì–´ì»¨: -';
          seatEl.textContent  = 'ì°©ì„: -';
          alarmEl.textContent = 'ì•ŒëŒ: -';
          alarmEl.className   = 'alarm-off';
          alarmMsgEl.textContent = '';
          return;
        }

        // ì˜ˆì•½ ì¼œì ¸ ìˆì„ ë•Œë§Œ ì‹¤ì œ ê°’ í‘œì‹œ
        tempEl.textContent =
          `ì˜¨ë„: ${state.temperature ?? '-'} Â°C`;
        acEl.textContent =
          `ì—ì–´ì»¨: ${state.acOn ? 'ON' : 'OFF'}`;
        seatEl.textContent =
          `ì°©ì„: ${state.seatUsed === null ? '-' : (state.seatUsed ? 'ì°©ì„ ì¤‘' : 'ìë¦¬ ë¹„ì›€')}`;

        // ğŸ”¥ ì•ŒëŒ ë©”ì‹œì§€
        if (state.alarm) {
          alarmEl.textContent = 'ì•ŒëŒ: í™œì„±í™” âš ï¸';
          alarmEl.className   = 'alarm-on';
          alarmMsgEl.textContent = 'ìë¦¬ì— ì°©ì„í•´ì£¼ì„¸ìš”.';
        } else {
          alarmEl.textContent = 'ì•ŒëŒ: ë¹„í™œì„±';
          alarmEl.className   = 'alarm-off';
          alarmMsgEl.textContent = '';
        }
      } catch (e) {
        console.error(e);
      }
    }

    window.addEventListener('load', () => {
      fetchStatus();
      setInterval(fetchStatus, 2000);
    });
  </script>
</body>
</html>
